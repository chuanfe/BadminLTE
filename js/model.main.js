var goodsStore_conf={before:[],after:["/js/m/analysis/goodsAnalysis.js"]};
var goodsCate_conf={before:[],after:["/js/m/goods/goodsCate.js"]};
var goodsFtp_conf={before:[],after:["/plugins/rome/rome.js","/plugins/pagination/extendPagination.js","/js/m/goods/goodsFtp.js"]};
var goodsStore_conf={before:[],after:["/js/m/goods/goodsStore.js","/plugins/DatePicker/WdatePicker.js","/plugins/artDialog/jquery.artDialog.min.js"]};
var setting_conf={before:["/js/m/setting/setting_v.js"],after:[]};
function ChangeGoodsView(e,t){var a=$(".goodsCharts"),r=$(e);r.parent().parent().find(".current").removeClass("current"),r.parent().addClass("current"),"0"==t?(a.addClass("hide"),a.eq(t).removeClass("hide"),QueryGoodsByParams()):"1"==t&&(a.addClass("hide"),a.eq(t).removeClass("hide"),QueryClassByParams())}function QueryGoodsOther(){if(!$("#BgTime").val())return!1;if(!$("#EndTime").val())return!1;var e={};e.BgTime=$("#BgTime").val(),e.EndTime=$("#EndTime").val(),$(".goodsCharts .dateSelectArea").data("date",e);var t="other";QueryGoodsByParams(t)}function ClassTableView(e){$("#classTable").bootstrapTable("destroy"),$("#classTable").bootstrapTable({sortable:!0,sortOrder:"total asc",clickToSelect:!0,striped:!0,onClickRow:function(t){window.location.href="/qStock/qProInfo/"+e.classname},formatLoadingMessage:function(){return""},columns:[{field:"classname",title:"大分类"},{field:"qty",title:"销售数量"},{field:"total",title:"销售金额"},{field:"percentage",title:"所占比例"},{field:"number",title:"明细"}],data:e})}function GoodsTableView(e){$("#table").bootstrapTable("destroy"),$("#table").bootstrapTable({sortable:!0,sortOrder:"total asc",clickToSelect:!0,striped:!1,formatLoadingMessage:function(){return""},columns:[{field:"id",title:"序号"},{field:"proname",title:"商品名称"},{field:"outsiderNumber",title:"散客"},{field:"vipNumber",title:"会员"},{field:"number",title:"销售数量"},{field:"total",title:"销售总额"},{field:"gross",title:"毛利润"},{field:"stock",title:"当前库存"},{field:"avggross",title:"日均利润"}],data:e})}function ChangeGoodsTopNum(e){var t=$(e);t.parent().parent().find(".cur").removeClass("cur"),t.parent().addClass("cur"),QueryGoodsByParams()}function dateSelect(e){var t=$(e);if(t.parent().find(".cur").removeClass("cur"),t.addClass("cur"),"other"==t.attr("date"))$(".dateSelectWrap").show();else{$(".dateSelectWrap").hide();var a={},r=parseInt($(".dateSelectArea li.cur").attr("lastDays"));a.BgTime=GetDateStr(r),a.EndTime=new Date,$(".goodsCharts .dateSelectArea").data("date",a),QueryGoodsByParams()}}function dateSelectClass(e){var t=$(e);if(t.parent().find(".cur").removeClass("cur"),t.addClass("cur"),"other"==t.attr("date"))$(".dateSelectWrap").show();else{$(".dateSelectWrap").hide();var a={},r=parseInt($(".dateSelectArea li.cur").attr("lastDays"));a.BgTime=GetDateStr(r),a.EndTime=new Date,$(".goodsCharts .dateSelectArea").data("date",a),QueryClassByParams()}}function memberSelect(e){var t=$(e);t.parent().find(".cur").removeClass("cur"),t.addClass("cur"),QueryGoodsByParams()}function ChangeValueType(e){var t=$(e);t.parent().parent().find(".ValueTypeSelect").removeClass("ValueTypeSelect"),t.parent().addClass("ValueTypeSelect"),QueryGoodsByParams()}function GetViewChartByMoney(e){var t=function(){for(var t=0,a=[],r=e.length;r--;)a.push(e[t].proname),t++;return a}(),a={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow",textStyle:{color:"#fff"}}},grid:{borderWidth:0,top:110,bottom:95,textStyle:{color:"#fff"}},legend:{x:"65%",top:"11%",textStyle:{color:"#90979c"},data:["销售金额","毛利润"]},calculable:!0,xAxis:{data:t},yAxis:{},series:[{name:"销售金额",type:"bar",stack:"总量",itemStyle:{normal:{color:"rgba(255,144,128,1)",label:{show:!0,textStyle:{color:"#fff"},position:"insideTop",formatter:function(e){return e.value>0?e.value:""}}}},data:function(){for(var t=0,a=[],r=e.length;r--;)a.push(e[t].total),t++;return a}()},{name:"毛利润",type:"bar",stack:"总量",itemStyle:{normal:{color:"rgba(0,191,183,1)",barBorderRadius:0,label:{show:!0,position:"top",formatter:function(e){return e.value>0?e.value:""}}}},data:function(){for(var t=0,a=[],r=e.length;r--;)a.push(e[t].gross),t++;return a}()}]};goodsChart.clear(),goodsChart.setOption(a)}function GetViewChartByNumber(e){var t=function(){for(var t=0,a=[],r=e.length;r--;)a.push(e[t].proname),t++;return a}(),a={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow",textStyle:{color:"#fff"}}},grid:{borderWidth:0,top:110,bottom:95,textStyle:{color:"#fff"}},legend:{x:"65%",top:"11%",textStyle:{color:"#90979c"},data:["数量"]},calculable:!0,xAxis:{data:t},yAxis:{},series:[{name:"数量",type:"bar",itemStyle:{normal:{color:"rgba(255,144,128,1)",label:{show:!0,textStyle:{color:"#fff"},position:"insideTop",formatter:function(e){return e.value>0?e.value:""}}}},data:function(){for(var t=0,a=[],r=e.length;r--;)a.push(e[t].number),t++;return a}()}]};goodsChart.clear(),goodsChart.setOption(a)}function GetViewChartByClass(e){option={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:[]},series:[{name:function(){for(var t=0,a=[],r=e.length;r--;)a.push(e[t].classname),t++;return a}(),type:"pie",radius:"55%",center:["50%","60%"],data:function(){for(var t=0,a=[],r=e.length;r--;)a.push({value:e[t].qty,name:e[t].classname}),t++;return a}(),itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},classChart.clear(),classChart.setOption(option)}function QueryGoodsByParams(e){var t=$(".goodsCharts .dateSelectArea").data("date");if(t)var a=t.BgTime,r=t.EndTime;else var o=parseInt($(".dateSelectArea li.cur").attr("lastDays")),a=GetDateStr(o),r=new Date;var s=$(".chartSelectArea li.cur a").attr("data"),l=$(".memberSelectArea li.cur").attr("vip");GetViewCharts(a,r,s,l)}function GetViewCharts(e,t,a,r){var o=new Object;o.TOPS=a,o.BEGINTIME=e,o.ENDTIME=t,o.ISVIP=r,$.ajax({type:"GET",url:"/p/cs/proSalesVolume",dataType:"jsonp",data:"PARAMS="+JSON.stringify(o),success:function(e){GoodsTableView(e.datas);var t=e.datas,a=$(".chartSelectArea"),r=a.find(".ValueTypeSelect a").attr("valuetype");"money"==r?GetViewChartByMoney(t):"number"==r&&GetViewChartByNumber(t)},error:function(e){}})}function QueryClassByParams(){var e=parseInt($(".classCharts .dateSelectArea li.cur").attr("lastDays")),t=GetDateStr(e),a=new Date,r="";ClassViewCharts(t,a,r)}function ClassViewCharts(e,t,a){var r=new Object;r.CLASSID=a,r.BEGINTIME=e,r.ENDTIME=t,$.ajax({type:"GET",url:"/p/cs/proClassSalesVolume",dataType:"jsonp",data:"PARAMS="+JSON.stringify(r),success:function(e){ClassTableView(e.datas);var t=e.datas,a=$(".chartSelectArea");a.find(".ValueTypeSelect a").attr("valuetype");GetViewChartByClass(t)},error:function(e){}})}function GetDateStr(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),r=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate();return a+"-"+r+"-"+o}function init(){goodsChart=echarts.init(document.getElementById("GoodsChartLine")),classChart=echarts.init(document.getElementById("ClassChartLine")),QueryGoodsByParams()}$(".form_date").datetimepicker({language:"fr",weekStart:1,todayBtn:1,autoclose:1,language:"cn",todayHighlight:1,startView:2,minView:2,forceParse:0,pickerPosition:"bottom-left"}),$(function(){init()});
function formatDateTime(a){var e=a.getFullYear(),t=a.getMonth()+1;t=t<10?"0"+t:t;var s=a.getDate();s=s<10?"0"+s:s;var o=a.getHours();o=o<10?"0"+o:o;var n=a.getMinutes();n=n<10?"0"+n:n;var d=a.getSeconds();return d=d<10?"0"+d:d,e+"-"+t+"-"+s+" "+o+":"+n+":"+d}function add0(a){return a=a<10?"0"+a:a}function suboneday(a){var e=Date.parse(a),t=e-864e5,s=new Date(t);return formatDateTime(s)}function getData(a,e,t,s,o){var n={MAXDATE:a,MINDATE:e,BEFOREMAXDATE:t,BEFOREMINDATE:s,ISVIP:o};$.ajax({url:"/p/cs/b_stchangeitem_sale",type:"GET",async:!0,dataType:"json",data:n,success:function(a){for(var e=a.logJson,t=e.length,s=[],o=[],n=[],d=0;d<t;d++)s.push(e[d].Date),o.push(e[d].Amount),n.push(e[d].GrossProfit);var i=a.differenceJson.AmountSum,l=a.differenceJson.GrossProfitSum,r=a.differenceJson.NetProfitSum,A=a.sumJson.NewVipSum,p=a.sumJson.CostSum,E=a.sumJson.AmountSum,D=a.sumJson.GrossProfitSum,T=a.sumJson.ExpenditureSum,c=a.sumJson.NetProfitSum,M=a.logJson;showStatistics(i,l,r,E,D,c),showChart01(s,o,n),showTable01(A,E,p,D,T,M)}})}function showStatistics(a,e,t,s,o,n){$(".statistics .Amount .over").html(a),$(".statistics .GrossProfit .over").html(e),$(".statistics .Profit .over").html(t),$(".statistics .Amount .acount1").html(s),$(".statistics .GrossProfit .acount1").html(o),$(".statistics .Profit .acount1").html(n)}function showChart01(a,e,t){var s=document.getElementById("chart01"),o=echarts.init(s);option={title:{},tooltip:{trigger:"axis"},legend:{data:["销售金额","毛利润"]},xAxis:[{type:"category",data:a,axisLabel:{show:!0,textStyle:{color:"black"}},axisLine:{lineStyle:{color:"#008acd",width:2}}}],yAxis:[{type:"value",axisLabel:{show:!0,textStyle:{color:"black"}},axisLine:{lineStyle:{color:"#008acd",width:2}}}],series:[{itemStyle:{normal:{color:"#70c5e7",lineStyle:{width:2}}},name:"销售金额",type:"line",data:e},{itemStyle:{normal:{color:"#6aadea",lineStyle:{width:2}}},name:"毛利润",type:"line",data:t}]},o.setOption(option)}function showTable01(a,e,t,s,o,n){$(".saleanalysis .charts table").empty();var d=n.length,i=$(".saleanalysis .charts table"),l=$("<tr></tr>");l.appendTo(i[0]);var r=$("<td>日期</td>");r.appendTo(l);var r=$("<td>新增会员(个)</td>");r.appendTo(l);var r=$("<td>销售金额(￥)</td>");r.appendTo(l);var r=$("<td>商品成本(￥)</td>");r.appendTo(l);var r=$("<td>毛利润(￥)</td>");r.appendTo(l);var r=$("<td>店铺支出(￥)</td>");r.appendTo(l);var l=$("<tr></tr>");l.appendTo(i[0]);var r=$("<td>总计</td>");r.appendTo(l);var r=$("<td>"+a+"</td>");r.appendTo(l);var r=$("<td>"+e+"</td>");r.appendTo(l);var r=$("<td>"+t+"</td>");r.appendTo(l);var r=$("<td>"+s+"</td>");r.appendTo(l);var r=$("<td>"+o+"</td>");r.appendTo(l);for(var A=0;A<d;A++){var l=$("<tr></tr>");l.appendTo(i[0]);var r=$("<td>"+n[A].Date+"</td>");r.appendTo(l);var r=$("<td>"+n[A].NewVip+"</td>");r.appendTo(l);var r=$("<td>"+n[A].Amount+"</td>");r.appendTo(l);var r=$("<td>"+n[A].Cost+"</td>");r.appendTo(l);var r=$("<td>"+n[A].GrossProfit+"</td>");r.appendTo(l);var r=$("<td>"+n[A].Expenditure+"</td>");r.appendTo(l)}}function suboneyear(a){var e=a.split("-");e[0]=e[0]-1;var t=e.join("-");return t}function subtwomonth(a){var e=a.split("-"),t=parseInt(e[1]);t<=2?(t=t+12-2,e[0]=e[0]-1):t-=2,t<9?e[1]="0"+t:e[1]=t,e[2]="01 00:00:00";var s=e.join("-");return s}function getData_1(a,e,t,s,o){var n={LIMIT:a,DAYMAXDATE:e,DAYMINDATE:t,MONTHMAXDATE:s,MONTHMINDATE:o};$.ajax({url:"/p/cs/b_stchangeitem_vipsave",type:"GET",async:!0,dataType:"json",data:n,success:function(a){dataresponse=a;for(var e=a.topJson.length,t=[],s=[],o=0;o<e;o++)t.push(a.topJson[o].VIP),s.push(a.topJson[o].AMOUNT);var n=a.saveByDayJson,d=a.saveByMonthJson,i=a.allSaveJson,l=a.notConsumeJson;a.balanceJson;showStore(n,d,i,l),showChart02(topTitle,t,s)}})}function showalert(a){$("#detailalert table").remove(),$("#detailalert div").remove();var e=$("<table>");$("#detailalert").css({"z-index":4}),e.css({width:500,"margin-bottom":0}),e.addClass("table table-hover"),e.appendTo($("#detailalert"));for(var t=a.length,s=0;s<t;s++){var o=$("<tr></tr>");o.appendTo(e);var n=$("<td>"+a[s].VIPNAME+"</td>");n.appendTo(o);var n=$("<td>"+a[s].CHARGEDATE+"</td>");n.appendTo(o);var n=$("<td>"+a[s].CHARGEREM+"</td>");n.appendTo(o);var n=$("<td>"+a[s].AMOUNT+"</td>");n.appendTo(o)}$("#detailalert table tr").attr({width:20})}function showChart02(a,e,t){var s=echarts.init(document.getElementById("chart02")),o={title:{text:a,textStyle:{color:"#274b6d",fontSize:"16px"}},tooltip:{},legend:{data:["销量"]},xAxis:{data:e},yAxis:{},series:[{name:"销量",type:"bar",itemStyle:{normal:{color:function(a){var e=["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];return e[a.dataIndex]}}},data:t}]};s.setOption(o)}function showStore(a,e,t,s){var o=$(".saleanalysis .back .page02 .part1 .valuetoday .ostore"),n=$(".saleanalysis .back .page02 .part1 .valuetoday .onumber");o.html(a.AMOUNT),n.html(a.VIPNUM);var d=$(".saleanalysis .back .page02 .part1 .valuemonth .ostore"),i=$(".saleanalysis .back .page02 .part1 .valuemonth .onumber");d.html(e.AMOUNT),i.html(e.VIPNUM);var l=$(".saleanalysis .back .page02 .part1 .valueall .ostore"),r=$(".saleanalysis .back .page02 .part1 .valueall .onumber");l.html(t.AMOUNT),r.html(t.VIPNUM);var A=$(".saleanalysis .back .page02 .part1 .balance .notconsume");A.html(s.CHARGEREM)}var tempmax=new Date,MAXDATE=formatDateTime(tempmax),MINDATE=tempmax.getFullYear()+"-"+add0(tempmax.getMonth()+1)+"-"+add0(tempmax.getDate())+" 00:00:00",BEFOREMAXDATE=suboneday(MAXDATE),BEFOREMINDATE=suboneday(MINDATE),ISVIP="ALL";getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP);var dataresponse;$(".back .page02").css("display","none");var LIMIT=10,tempdaymax=new Date,DAYMAXDATE=formatDateTime(tempdaymax),DAYMINDATE=tempdaymax.getFullYear()+"-"+add0(tempdaymax.getMonth()+1)+"-"+add0(tempdaymax.getDate())+" 00:00:00",MONTHMAXDATE=DAYMAXDATE,MONTHMINDATE=tempdaymax.getFullYear()+"-"+add0(tempdaymax.getMonth()+1)+"-01 00:00:00";$("#_date1").datetimepicker({language:"fr",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,format:"yyyy-mm-dd",endDate:MAXDATE}),$("#_date2").datetimepicker({language:"fr",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,format:"yyyy-mm-dd"}),$(".tab div").click(function(){if($(".tab div").removeClass("active"),$(this).addClass("active"),0==$(this).index()){$(".back .page01").css("display","block"),$(".back .page02").css("display","none"),$(".saleanalysis .Lcalendar").css("display","none"),$(".time div").removeClass("active"),$(".time div").eq(0).addClass("active");var a=new Date;MAXDATE=formatDateTime(a),MINDATE=a.getFullYear()+"-"+add0(a.getMonth()+1)+"-"+add0(a.getDate())+" 00:00:00",BEFOREMAXDATE=suboneday(MAXDATE),BEFOREMINDATE=suboneday(MINDATE),getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)}1==$(this).index()&&($(".back .page02").css("display","block"),$(".back .page01").css("display","none"),$(".saleanalysis .Lcalendar").css("display","none"),LIMIT=10,getData_1(LIMIT,DAYMAXDATE,DAYMINDATE,MONTHMAXDATE,MONTHMINDATE))}),$(".time>div").click(function(){$(".time div").removeClass("active"),$(this).addClass("active");var a=$(this).index();$(".statistics .pick0");if(0==a?$(".statistics .pick0").html("超出昨天"):$(".statistics .pick0").html("超出同期"),0==a){$(".saleanalysis .Lcalendar").css("display","none");var e=new Date;MAXDATE=formatDateTime(e),MINDATE=e.getFullYear()+"-"+add0(e.getMonth()+1)+"-"+add0(e.getDate())+" 00:00:00",BEFOREMAXDATE=suboneday(MAXDATE),BEFOREMINDATE=suboneday(MINDATE),getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)}if(1==a){$(".saleanalysis .Lcalendar").css("display","none");var e=new Date;MAXDATE=formatDateTime(e),MINDATE=e.getFullYear()+"-"+add0(e.getMonth()+1)+"-01 00:00:00",1==e.getDate()?(BEFOREMAXDATE=suboneday(MAXDATE),BEFOREMINDATE=suboneday(MINDATE)):(BEFOREMAXDATE=suboneyear(MAXDATE),BEFOREMINDATE=suboneyear(MINDATE)),getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)}if(2==a){$(".saleanalysis .Lcalendar").css("display","none");var e=new Date;if(MINDATE=e.getMonth()+1==1?e.getFullYear()-1+"-12-01 00:00:00":e.getFullYear()+"-"+add0(e.getMonth())+"-01 00:00:00",e.getMonth()+1==1)MAXDATE=e.getFullYear()-1+"-12-31 23:59:59";else if(1==e.getMonth()||3==e.getMonth()||5==e.getMonth()||7==e.getMonth()||8==e.getMonth()||10==e.getMonth())MAXDATE=e.getFullYear()+"/"+add0(e.getMonth())+"-31 23:59:59";else{var t=e.getFullYear();MAXDATE=2==e.getMonth()?t%4==0&&t%100!=0||t%400==0?e.getFullYear()+"-"+add0(e.getMonth())+"-29 23:59:59":e.getFullYear()+"-"+add0(e.getMonth())+"-28 23:59:59":e.getFullYear()+"-"+add0(e.getMonth())+"-30 23:59:59"}BEFOREMAXDATE=suboneyear(MAXDATE),BEFOREMINDATE=suboneyear(MINDATE),getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)}if(3==a){$(".saleanalysis .Lcalendar").css("display","none");var e=new Date;MAXDATE=formatDateTime(e),MINDATE=subtwomonth(MAXDATE),BEFOREMAXDATE=suboneyear(MAXDATE),BEFOREMINDATE=suboneyear(MINDATE),getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)}4==a&&$(".saleanalysis .Lcalendar").css("display","block")});var _startdate,_enddate;$(".Lcalendar .lsearch").click(function(){getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)}),$("#_date1").datetimepicker().on("changeDate",function(a){MINDATE=$("#_startdate").val()+" 00:00:00",_startdate=Date.parse(MINDATE.replace(/-/g,"/")),$("#_date2").datetimepicker("setStartDate",MINDATE)}),$("#_date2").datetimepicker().on("changeDate",function(a){MAXDATE=$("#_enddate").val()+" 23:59:59",_enddate=Date.parse(MAXDATE.replace(/-/g,"/")),_enddate-_startdate<864e5?(BEFOREMINDATE=suboneday(MINDATE),BEFOREMAXDATE=suboneday(MAXDATE)):(BEFOREMINDATE=suboneyear(MINDATE),BEFOREMAXDATE=suboneyear(MAXDATE))}),$(".viparea div").click(function(){$(".viparea div").removeClass("active"),$(this).addClass("active"),0==$(this).index()&&(ISVIP="ALL"),1==$(this).index()&&(ISVIP="Y"),2==$(this).index()&&(ISVIP="N"),getData(MAXDATE,MINDATE,BEFOREMAXDATE,BEFOREMINDATE,ISVIP)});var topTitle="会员储值排行Top10",lindex;$(".saleanalysis .back .page02 .part2 .rank li").click(function(){$(".saleanalysis .back .page02 .part2 .rank li").removeClass("active"),$(this).addClass("active"),lindex=$(this).index(),LIMIT=10*($(this).index()+1),topTitle="会员储值排行Top"+LIMIT,getData_1(LIMIT,DAYMAXDATE,DAYMINDATE,MONTHMAXDATE,MONTHMINDATE)}),$(".saleanalysis .back .page02 .part2 .rank li").mouseover(function(){$(this).addClass("active")}),$(".saleanalysis .back .page02 .part2 .rank li").mouseleave(function(){lindex==$(this).index()||$(this).removeClass("active")}),$(".valuetoday a").click(function(){if(getData_1(LIMIT,DAYMAXDATE,DAYMINDATE,MONTHMAXDATE,MONTHMINDATE),dataresponse.saveByDayJson.VIPNUM)$("#detailalert").css({display:"block",left:200,top:100}),temp=dataresponse.balanceByDayJson,showalert(temp);else{var a=$("<div id='fadeout0'>没有会员进行储值</div>");a.css({width:200,height:80,"background-color":"gray",display:"none",position:"absolute",top:140,left:380,"z-index":5,"text-align":"center",color:"#fff",border:"1px #D1D1D1 solid","line-height":"80px"}),a.appendTo($(".page02")),$("#fadeout0").fadeIn("normal"),$("#fadeout0").fadeOut(1400)}}),$(".valuemonth a").click(function(){if(getData_1(LIMIT,DAYMAXDATE,DAYMINDATE,MONTHMAXDATE,MONTHMINDATE),dataresponse.saveByDayJson.VIPNUM)$("#detailalert").css({display:"block",left:200,top:100}),temp=dataresponse.balanceByMonthJson,showalert(temp);else{var a=$("<div id='fadeout0'>没有会员进行储值</div>");a.css({width:200,height:80,"background-color":"gray",display:"none",position:"absolute",top:140,left:380,"z-index":5,"text-align":"center",color:"#fff",border:"1px #D1D1D1 solid","line-height":"80px"}),a.appendTo($(".page02")),$("#fadeout0").fadeIn("normal"),$("#fadeout0").fadeOut(1400)}}),$(".valueall a").click(function(){if(getData_1(LIMIT,DAYMAXDATE,DAYMINDATE,MONTHMAXDATE,MONTHMINDATE),dataresponse.allSaveJson.VIPNUM)$("#detailalert").css({display:"block",left:200,top:100}),temp=dataresponse.balanceJson,showalert(temp);else{var a=$("<div id='fadeout0'>没有会员进行储值</div>");a.css({width:200,height:80,"background-color":"gray",display:"none",position:"absolute",top:140,left:380,"z-index":5,"text-align":"center",color:"#fff",border:"1px #D1D1D1 solid","line-height":"80px"}),a.appendTo($(".page02")),$("#fadeout0").fadeIn("normal"),$("#fadeout0").fadeOut(1400)}}),$("#detail").click(function(){if(getData_1(LIMIT,DAYMAXDATE,DAYMINDATE,MONTHMAXDATE,MONTHMINDATE),dataresponse.notConsumeJson.CHARGEREM)$("#detailalert").css({display:"block",left:200,top:100}),temp=dataresponse.balanceJson,showalert(temp);else{var a=$("<div id='fadeout0'>没有未消费余额</div>");a.css({width:200,height:80,"background-color":"gray",display:"none",position:"absolute",top:140,left:380,"z-index":5,"text-align":"center",color:"#fff",border:"1px #D1D1D1 solid","line-height":"80px"}),a.appendTo($(".page02")),$("#fadeout0").fadeIn("normal"),$("#fadeout0").fadeOut(1400)}});
$(function(){function i(){$(".beif-tab").find("span").on("click",function(){$(this).siblings(".zhankai").toggleClass("hide"),$(this).siblings(".shouqi").toggleClass("hide"),$(this).parent(".beif-tab").parent(".edit-father-tab").siblings(".beif-list-tab").toggleClass("hide")})}function t(){$("input").keydown(function(i){var t=$(this).val();""!=t&&13==i.keyCode&&(r=!0,l=!0,$(this).addClass("hide"),$(this).siblings("span").removeClass("hide").text(t),$(this).parent(".beic-tab").siblings(".work-icons").removeClass("hide"),$(this).parent(".beif-tab").siblings(".work-icons").removeClass("hide"),$(this).siblings(".shouqi").hasClass("hide")&&$(this).siblings(".zhankai").hasClass("hide")&&$(this).siblings(".shouqi").removeClass("hide"),b?p?$(this).parent().attr("id").indexOf("father")>=0?$.ajax({url:"/p/cs/creat",dataType:"json",data:{name:$(this).siblings("span").text(),parentid:-1,orderno:$(this).parent().attr("id").split("D")[1]},type:"GET",success:function(i){d=i.code,$(this).parent().attr("id","fatherID'+parentCreat+'")},error:function(){}}):$.ajax({url:"/p/cs/creat",dataType:"json",data:{name:$(this).siblings("span").text(),parentid:1,orderno:$(this).parent().attr("id").split("D")[1]},type:"GET",success:function(i){$(this).parent().attr("id","childID'+parentCreat+'")},error:function(){}}):(p=!0,$.ajax({type:"get",url:"/p/cs/modify",data:"",success:function(){}})):(b=!0,$.ajax({type:"get",url:"/p/cs/modify",data:$(this).parent(".work-icons").siblings(".beif-tab").attr("id").split("ID")[1],success:function(){}})))}),$(".todown-icon").unbind("click").bind("click",function(i){void 0==$(this).parent(".work-icons").parent("li").next().html()||$(this).parent(".work-icons").parent("li").next().after($(this).parent(".work-icons").parent("li"))}),$(".toup-icon").unbind("click").bind("click",function(i){void 0==$(this).parent(".work-icons").parent("li").prev().html()||$(this).parent(".work-icons").parent("li").prev().before($(this).parent(".work-icons").parent("li"))}),i()}function n(){$(".edit-icon").unbind("click"),$(".edit-icon").bind("click",function(){p=!1,$(this).parent(".work-icons").siblings(".beic-tab").find("input").removeClass("hide"),$(this).parent(".work-icons").siblings(".beic-tab").find("span").addClass("hide")}),$(".edit-icon").on("click",function(){var i=$(this).parent(".work-icons").siblings(".beic-tab").find("input").val();$(this).parent(".work-icons").siblings(".beic-tab").find("input").val("").focus().val(i)})}function a(){$(".delete-icon").unbind("click"),$(".delete-icon").bind("click",function(){$(this).parent(".work-icons").parent("li").remove(),$.ajax({type:"get",url:"/p/cs/delete",data:"",success:function(){}})})}function s(){$(".add-child-tab").unbind("click"),$(".add-child-tab").bind("click",function(){if(r){var i=0;for(i=0;i<$(this).parent(".add-child-link").siblings(".child-tab-ul").find("li").length;i++){r=!1;var s='<li><div class="beic-tab" id="childID'+(i+2)+'"><input class="edit-input" type="text" placeholder="请输入"/><span class="hide">项链</span></div><div class="work-icons"><a class="edit-icon"><i class="iconfont">&#xe77d;</i></a>&nbsp;<a class="delete-icon"><i class="iconfont">&#xe660;</i></a>&nbsp;<a class="toup-icon"><i class="iconfont">&#xe62b;</i></a>&nbsp;<a class="todown-icon"><i class="iconfont">&#xe639;</i></a>&nbsp;</div></li>'}$(this).parent(".add-child-link").siblings(".child-tab-ul").append(s),$(".child-tab-ul").find("li").last().find(".beic-tab").find("input").addClass("edit-input").focus(),t(),n(),a()}else t()})}function e(){$(".father-edit-icon").unbind("click"),$(".father-edit-icon").bind("click",function(){b=!1;var i=$(this).parent(".work-icons").siblings(".beif-tab").find("span"),t=$(this).parent(".work-icons").siblings(".beif-tab").find("input"),n=t.val();t.val("").focus().val(n),i.addClass("hide"),t.removeClass("hide")})}function c(){$(".father-delete-icon").unbind("click"),$(".father-delete-icon").bind("click",function(){$(this).parent(".work-icons").parent(".edit-father-tab").parent(".father-tab-cont").parent(".tab-group").remove(),$.ajax({type:"get",url:"/p/cs/delete",data:$(this).parent(".work-icons").siblings(".beif-tab").attr("id").split("ID")[1],success:function(){}})})}function o(){$(".add-father-tab").unbind("click"),$(".add-father-tab").bind("click",function(){if(l){var i=0;for(i=0;i<$(".tab-group").length;i++){l=!1;var n='<div class="tab-group"><div class="father-tab-cont"><div class="edit-father-tab"><div id="fatherID'+(i+2)+'" class="beif-tab" href="javascript:void(0)"><i class="iconfont zhankai hide">&#xe605;</i><i class="iconfont shouqi hide">&#xe6bd;</i><input class="edit-input" type="text" value="服装"/><span class="hide">服装</span></div><div class="work-icons hide"><a class="father-edit-icon"><i class="iconfont">&#xe77d;</i></a>&nbsp;<a class="father-delete-icon"><i class="iconfont">&#xe660;</i></a>&nbsp;<a class="father-toup-icon"><i class="iconfont">&#xe62b;</i></a>&nbsp;<a class="father-todown-icon"><i class="iconfont">&#xe639;</i></a>&nbsp;</div></div><div class="beif-list-tab hide"><div class="child-tab"><ul class="child-tab-ul"><li style="display:none;"></li></ul><div class="add-child-link"><a class="add-child-tab">新增<i class="iconfont">&#xe6ed;</i></a></div></div></div></div></div>'}$(".tab-cont").append(n),t(),s(),e(),c(),$(".father-todown-icon").unbind("click").bind("click",function(i){$(this).parents(".tab-group").next().after($(this).parents(".tab-group"))}),$(".father-toup-icon").unbind("click").bind("click",function(i){$(this).parents(".tab-group").prev().before($(this).parents(".tab-group"))})}else t()}),$(".add-father-tab").on("click",function(){var i=$(".edit-father-tab").find("input").val();$(".edit-father-tab").find("input").val("").focus().val(i)})}$.ajax({type:"get",url:"/p/cs/load",success:function(){for(var i="",t=0;t<C_PROCLASS_LOAD.length;t++)for(var n=0;n<C_PROCLASS_LOAD[t].subdata.length;n++)i='<div class="tab-group"><a id="'+C_PROCLASS_LOAD[t].id+'" class="accordion-toggle beif-tab" href="javascript:void(0)">'+C_PROCLASS_LOAD[t].name+'<i class="iconfont zhankai">&#xe605;</i><i class="iconfont zhankai">&#xe605;</i></a><div class="beif-list-tab"><div class="child-tab"><ul><li><div class="beic-tab"><input type="text" id="'+C_PROCLASS_LOAD[t].subdata[n].id+'" value="'+C_PROCLASS_LOAD[t].subdata[n].name+'" disabled="disabled"/></div><div class="work-icons"><a class="edit-icon"><i class="iconfont">&#xe77d;</i></a>&nbsp;<a class="delete-icon"><i class="iconfont">&#xe660;</i></a>&nbsp;<a class="toup-icon"><i class="iconfont">&#xe62b;</i></a>&nbsp;<a class="todown-icon"><i class="iconfont">&#xe639;</i></a>&nbsp;</div></li></ul></div></div></div>';$(".bei-tab").append(i)}});var d,l=!0,r=!0,b=!0,p=!0;t(),$(".father-todown-icon").unbind("click").bind("click",function(i){void 0==$(this).parents(".tab-group").next().html()||$(this).parents(".tab-group").next().after($(this).parents(".tab-group"))}),$(".father-toup-icon").unbind("click").bind("click",function(i){void 0==$(this).parents(".tab-group").prev().html()||$(this).parents(".tab-group").prev().before($(this).parents(".tab-group"))}),n(),a(),s(),e(),c(),o()});
$(function(){function t(t,i){var a="",n="",s="";if("pro-input"==i){var l=p.split("</li>");l.pop();for(var r=0;r<l.length;r++)l[r]=l[r]+"</li>",$(l[r]).text().indexOf(t)>=0&&(a+="<li>"+$(l[r]).text()+"</li>");$(".pro-cont").html(a),$(".client-cont").hide(),$(".store-cont").hide(),$(".pro-cont").show(),$(".pro-cont").find("li").on("click",function(){$(".client-input").val(""),$(".filterResult").find(".client-li").remove(),$(".pro-input").val($(this).text()),$(".pro-cont").hide();var t='<li class="pro-li select active"><a href="javascript:void(0);"><span>供应商:'+$(this).text()+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("li").hasClass("pro-li")?($(".pro-li").remove(),""==$(".pro-input").val()||($(".filterResult").find("ul").append(t),e())):""==$(".pro-input")||($(".filterResult").find("ul").append(t),e())})}else if("client-input"==i){var o=u.split("</li>");o.pop();for(var r=0;r<o.length;r++)o[r]=o[r]+"</li>",$(o[r]).text().indexOf(t)>=0&&(n+="<li>"+$(o[r]).text()+"</li>");$(".client-cont").html(n),$(".pro-cont").hide(),$(".store-cont").hide(),$(".client-cont").show(),$(".client-cont").find("li").on("click",function(){$(".pro-input").val(""),$(".filterResult").find(".pro-li").remove(),$(".client-input").val($(this).text()),$(".client-cont").hide();var t='<li class="client-li select active"><a href="javascript:void(0);"><span>客户:'+$(this).text()+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("li").hasClass("client-li")?($(".client-li").remove(),""==$(".client-input").val()||($(".filterResult").find("ul").append(t),e())):""==$(".client-input")||($(".filterResult").find("ul").append(t),e())})}else if("store-input"==i){var d=f.split("</li>");d.pop();for(var r=0;r<d.length;r++)d[r]=d[r]+"</li>",$(d[r]).text().indexOf(t)>=0&&(s+="<li>"+$(d[r]).text()+"</li>");$(".store-cont").html(s),$(".pro-cont").hide(),$(".client-cont").hide(),$(".store-cont").show(),$(".store-cont").find("li").on("click",function(){$(".store-input").val($(this).text()),$(".store-cont").hide();var t='<li class="store-li select active"><a href="javascript:void(0);"><span>仓库:'+$(this).text()+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("li").hasClass("store-li")?($(".store-li").remove(),""==$(".store-input")||($(".filterResult").find("ul").append(t),e())):""==$(".store-input")||($(".filterResult").find("ul").append(t),e())})}}function e(){$(".filterResult").find("a").on("click",function(){$(this).parent("li").hasClass("store-li")?($(".store-li").remove(),$(".store-input").val("")):$(this).parent("li").hasClass("pro-li")||$(this).parent("li").hasClass("client-li")?($(".pro-li").remove(),$(".client-li").remove(),$(".pro-input").val(""),$(".client-input").val("")):$(this).parent("li").hasClass("chosed-trans-num")?($(".chosed-trans-num").remove(),$(".num-range").find("input").val(""),$(".trans-num").find("a").addClass("active")):$(this).parent("li").hasClass("chosed-trans-money")?($(".chosed-trans-money").remove(),$(".money-range").find("input").val(""),$(".trans-money").find("a").addClass("active")):$(this).parent("li").hasClass("chosed-inout-type")&&($(".chosed-inout-type").remove(),$(".inout-type").find("a").removeClass("active"),$(".inout-type").find(".noadd").addClass("active"))})}function i(){$(".filterOutterResult").find("a").on("click",function(){0!==$(this).parent("li").siblings("li").length||$(".filterOutterResult").hide(),$(this).parent("li").hasClass("store-li")?($(".store-li").remove(),$(".store-input").val("")):$(this).parent("li").hasClass("pro-li")||$(this).parent("li").hasClass("client-li")?($(".pro-li").remove(),$(".client-li").remove(),$(".pro-input").val(""),$(".client-input").val("")):$(this).parent("li").hasClass("chosed-trans-num")?($(".chosed-trans-num").remove(),$(".num-range").find("input").val(""),$(".trans-num").find("a").addClass("active")):$(this).parent("li").hasClass("chosed-trans-money")?($(".chosed-trans-money").remove(),$(".money-range").find("input").val(""),$(".trans-money").find("a").addClass("active")):$(this).parent("li").hasClass("chosed-inout-type")&&($(".chosed-inout-type").remove(),$(".inout-type").find("a").removeClass("active"),$(".inout-type").find(".noadd").addClass("active")),a(),l(),r()})}function a(){var t=$(".inout-type").find(".active").attr("value"),e=$(".store-type-radio").find(".checked").find("input").attr("name"),i=$(".search-record").find("input").val(),a=$(".min-num").val(),n=$(".max-num").val(),s=$(".min-money").val(),l=$(".max-money").val(),r=$(".pro-input").val(),o=$(".client-input").val(),d=$(".store-input").val(),p=[];t&&p.push("billsource:'"+t+"'"),""==$(".pro-input").val()?""==$(".client-input").val()||p.push("partner:'"+o+"'"):""==$(".client-input").val()?p.push("partner:'"+r+"'"):p.push("partner:'"+r+"'"),d&&p.push("storename:'"+d+"'"),e&&p.push("billtype:'"+e+"'"),i&&p.push("default:'"+i+"' OR firstletter:'"+i+"'"),c.indexs=p;var u=[];a?n?u.push("qty>="+a+" AND qty<="+n):u.push("qty>="+a):n&&u.push("qty<="+n),s?l?u.push("amount>="+s+" AND amount<="+l):u.push("amount>="+s):l&&u.push("amount<="+l);var f=$(".record-date").find(".active").attr("name"),h=new Date,v=h.getFullYear(),m=parseInt(h.getMonth()),g=parseInt(h.getDate()),y=new Date(v,m,g,0,0,0).getTime(),C=new Date(v,m,g+1,0,0,0).getTime();if("today"==f)u.push("modifieddate>="+y+" AND modifieddate<="+C);else if("month"==f){var x=new Date(v,m,1,0,0,0).getTime(),b=new Date,R=m+1,N=g;4==R||6==R||9==R||11==R?(N=30,b=new Date(v,m,30,0,0,0).getTime(),u.push("modifieddate>="+x+" AND modifieddate<="+b)):2==R?isNaN(parseInt(v))||(v%4==0&&v%100!=0||v%100==0&&v%400==0?(N=29,b=new Date(v,m,29,0,0,0).getTime(),u.push("modifieddate>="+x+" AND modifieddate<="+b)):(N=28,b=new Date(v,m,28,0,0,0).getTime(),u.push("modifieddate>="+x+" AND modifieddate<="+b))):(N=31,b=new Date(v,m,31,0,0,0).getTime(),u.push("modifieddate>="+x+" AND modifieddate<="+b))}else if("7"==f){var k=new Date(v,m,g-7,0,0,0).getTime();u.push("modifieddate>="+k+" AND modifieddate<="+y)}else if("30"==f){var A=new Date(v,m,g-30,0,0,0).getTime();u.push("modifieddate>="+A+" AND modifieddate<="+y)}else if("others"==f){var D=$(".self-start").val(),S=$(".self-end").val(),w=D.split("-"),O=S.split("-");v=w[0],m=parseInt(w[1])-1,g=w[2];var T=new Date(v,m,g,0,0,0).getTime(),I=h.getFullYear(),j=parseInt(h.getMonth()),J=parseInt(h.getDate());I=O[0],j=parseInt(O[1])-1,J=O[2];var M=new Date(I,j,J,0,0,0).getTime();""==D?""==S||u.push("modifieddate<="+M):""==S?u.push("modifieddate>="+T):u.push("modifieddate>="+T+" AND modifieddate<="+M)}return c.filter=u,c}function n(t){var e=Number($(".rows-page").val());s(1,e,t),$("#callBackPager").extendPagination({totalCount:t,limit:e,callback:function(t,e,i){s(t,e,i)}})}function s(t,e,i){var a=e;i-t*e<0&&(a=i-(t-1)*e)}function l(){$.ajax({url:"/p/cs/LoadStchangeItem",type:"get",data:{PARAM:JSON.stringify(c)},success:function(t){n(t.result.total)},error:function(t){}})}function r(){$.ajax({url:"/p/cs/LoadStchangeItem",type:"get",data:{PARAM:JSON.stringify(c)},success:function(t){$(".record-table").find("tbody").html(""),$(".scott").remove();var e=t.result.items,i='<tr id="table-info"><td colspan="10"><span style="float:right;"><img style="cursor:pointer;margin-top:6px;" src="beiCSSJS/img/close.gif"/></span>当前共有<span id="gSumNumber" class="number" style="font-size:12px;">'+e.length+'</span>项纪录，<span id="gsumTip">发生金额共计<span class="number moneyFont" style="font-size:12px;">&yen;0</span></span></td></tr>';$(".record-table").find("tbody").append(i);for(var a=0;a<e.length;a++){var n=new Date(parseInt(e[a].billdate));n=n.toLocaleString();var s="<tr><td>"+n+"</td><td>"+e[a].billsource+"</td><td>"+e[a].proclass+"</td><td>"+e[a].proname+"</td><td></td><td>"+e[a].qtybeg+"</td><td>"+e[a].qty+"</td><td>"+e[a].amount+"</td><td></td><td></td></tr>";$(".record-table").find("tbody").append(s)}o()},error:function(t){}})}function o(){$(".sorting").on("click",function(){var t={};t.order="";var e=[];"原始数量"==$(this).text()?t.field="qtybeg":"异动数量"==$(this).text()?t.field="qty":"异动金额"==$(this).text()&&(t.field="amount"),$(this).hasClass("asc")?($(this).removeClass("asc"),$(this).attr("title","默认排序"),t.order="",e.push(JSON.stringify(t))):$(this).hasClass("desc")?($(this).addClass("asc"),$(this).removeClass("desc"),$(this).attr("title","升序"),t.order="+",e.push(JSON.stringify(t))):($(this).addClass("desc"),$(this).attr("title","降序"),t.order="-",e.push(JSON.stringify(t))),c.sort=e,$.ajax({url:"/p/cs/LoadStchangeItem",type:"get",data:{PARAM:JSON.stringify(c)},success:function(t){var e=t.result.items;$(".record-table").find("tbody").html(""),$(".scott").remove();var i='<tr id="table-info"><td colspan="10"><span style="float:right;"><img style="cursor:pointer;margin-top:6px;" src="beiCSSJS/img/close.gif"/></span>当前共有<span id="gSumNumber" class="number" style="font-size:12px;">'+e.length+'</span>项纪录，<span id="gsumTip">发生金额共计<span class="number moneyFont" style="font-size:12px;">&yen;0</span></span></td></tr>';$(".record-table").find("tbody").append(i);for(var a=0;a<e.length;a++){var n=new Date(parseInt(e[a].billdate));n=n.toLocaleString();var s="<tr><td>"+n+"</td><td>"+e[a].billsource+"</td><td>"+e[a].proclass+"</td><td>"+e[a].proname+"</td><td></td><td>"+e[a].qtybeg+"</td><td>"+e[a].qty+"</td><td>"+e[a].amount+"</td><td></td><td></td></tr>";$(".record-table").find("tbody").append(s)}},error:function(t){}})})}function d(){var t=$(".filterResult").find("ul").html();0==$(".filterResult").find("ul").find("li").length||($(".filterOutterResult").show(),$(".filterOutterResult").html(""),$(".filterOutterResult").append('<span class="record-span pull-left">已选择</span><ul>'+t+"</ul>"),$(".record-cont").addClass("hide")),i()}var c={},p="",u="",f="";$(document).ready(function(){function t(t){$("."+t).next().next().hasClass("active")||($(".detailBody").find("tbody").html(""),a(),c.pagesize=$(".rows-page").val(),c.page=parseInt($(".pagination").find(".active").find("a").text())-1,r())}function e(t){$("."+t).prev().prev().hasClass("active")||($(".detailBody").find("tbody").html(""),a(),c.pagesize=$(".rows-page").val(),c.page=parseInt($(".pagination").find(".active").find("a").text())+1,r())}function i(t){a(),c.pagesize=$(".rows-page").val(),c.page=$(".pagination").find("."+t).find("a").text(),r()}var n={TABLENAME:"c_sup",COLUMNS:"id,supname"},s={TABLENAME:"c_vip",COLUMNS:"id,vipname"},o={TABLENAME:"c_store",COLUMNS:"id,storename"};$.ajax({url:"/p/cs/QueryTable",type:"get",data:{PARAM:JSON.stringify(n)},success:function(t){for(var e=JSON.parse(t.result),i=0;i<e.length;i++){var a="<li>"+e[i].supname+"</li>";$(".pro-cont").append(a)}p=$(".pro-cont").html()},error:function(t){}}),$.ajax({url:"/p/cs/QueryTable",type:"get",data:{PARAM:JSON.stringify(s)},success:function(t){for(var e=JSON.parse(t.result),i=0;i<e.length;i++){var a="<li>"+e[i][1]+"</li>";$(".client-cont").append(a)}u=$(".client-cont").html()},error:function(t){}}),$.ajax({url:"/p/cs/QueryTable",type:"get",data:{PARAM:JSON.stringify(o)},success:function(t){for(var e=JSON.parse(t.result),i=0;i<e.length;i++){var a="<li>"+e[i][1]+"</li>";$(".store-cont").append(a)}f=$(".store-cont").html()},error:function(t){}}),c={indexs:[],filter:["modifieddate>=1480521600000 AND modifieddate<=1481126400000"],pagesize:"10",page:"1"},l(),r(),$(".rows-page").change(function(){a(),c.pagesize=$(this).val(),c.page=$(".pagination").find(".active").find("a").text(),l(),r()}),$(document).on("click","#callBackPager .pagination li",function(){$(".detailBody").find("tbody").html(""),$(this).hasClass("previous")?t("previous"):$(this).hasClass("next")?e("next"):$(this).hasClass("active")&&i("active")})}),rome(startT,{time:!1,dateValidator:rome.val.beforeEq(endT)}),rome(endT,{time:!1,dateValidator:rome.val.afterEq(startT)}),$(".pro-input").on("click",function(e){e.stopPropagation(),t($(this).val(),"pro-input")}),$(".pro-input").keyup(function(){t($(this).val(),"pro-input"),""==$(this).val()&&$(".filterResult").find(".pro-li").remove()}),$(".client-input").on("click",function(e){e.stopPropagation(),t($(this).val(),"client-input")}),$(".client-input").keyup(function(){t($(this).val(),"client-input"),""==$(this).val()&&$(".filterResult").find(".client-li").remove()}),$(".store-input").on("click",function(e){e.stopPropagation(),t($(this).val(),"store-input")}),$(".store-input").keyup(function(){t($(this).val(),"store-input"),""==$(this).val()&&$(".filterResult").find(".store-li").remove()}),$(".filter-record").on("click",function(){$(".filterOutterResult").hide(),$(".record-cont").toggleClass("hide")}),$(".store-type-radio").find("label").on("click",function(){a(),l(),r(),$(".store-type-radio").find("label").removeClass("checked"),$(this).addClass("checked"),$(this).hasClass("all-store")||($(this).hasClass("in-store-radio")?($(".in-store").removeClass("hide"),$(".out-store").addClass("hide")):$(this).hasClass("out-store-radio")&&($(".out-store").removeClass("hide"),$(".in-store").addClass("hide")))}),$(".record-date").find("li").on("click",function(){$(".record-date").find("li").removeClass("active"),$(this).addClass("active"),$(this).hasClass("other-date")?$(".self-calendar").removeClass("hide"):($(".self-calendar").addClass("hide"),a(),l(),r())}),$(".search-date").on("click",function(){a(),l(),r()}),$("html").click(function(){$(".pro-cont").is(":hidden")||$(".pro-cont").hide(),$(".client-cont").is(":hidden")||$(".client-cont").hide(),$(".store-cont").is(":hidden")||$(".store-cont").hide()}),$(".record-cont-list").find("a").on("click",function(){if($(this).parents(".record-cont-list").find("a").removeClass("active"),$(this).addClass("active"),$(this).hasClass("noadd"))$(".other-record").find("input").val(""),$(this).parents("ul").hasClass("inout-type")?$(".filterResult").find(".chosed-inout-type").remove():$(this).parents("ul").hasClass("trans-num")?$(".filterResult").find(".chosed-trans-num").remove():$(this).parents("ul").hasClass("trans-money")&&$(".filterResult").find(".chosed-trans-money").remove();else if($(".filterResult").find(".chosed-inout-type").remove(),$(this).parents("ul").hasClass("inout-type")){var t='<li class="chosed-inout-type select active"><a href="javascript:void(0);"><span>'+$(this).text()+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(t),e()}}),$(".search-input").keydown(function(t){13==t.keyCode&&(a(),l(),r())}),$(".other-record").find("input").focus(function(){$(this).parents("ul").find(".noadd").removeClass("active"),$(this).keyup(function(){if(/[^\d]/.test($(this).val())){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}var i=$(".min-num").val(),a=$(".max-num").val(),n=$(".min-money").val(),s=$(".max-money").val();if($(this).parents("ul").hasClass("trans-num"))if($(".filterResult").find(".chosed-trans-num").remove(),""==i)if(""==a);else{var l='<li class="chosed-trans-num select active"><a href="javascript:void(0);"><span>异动数量小于等于'+a+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(l),e()}else if(""==a){var l='<li class="chosed-trans-num select active"><a href="javascript:void(0);"><span>异动数量大于等于'+i+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(l),e()}else{if(parseInt(i)>=parseInt(a))return;var l='<li class="chosed-trans-num select active"><a href="javascript:void(0);"><span>异动数量在'+i+"到"+a+'之间</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(l),e()}else if($(this).parents("ul").hasClass("trans-money"))if($(".filterResult").find(".chosed-trans-money").remove(),""==n){if(""==s)return;var r='<li class="chosed-trans-money select active"><a href="javascript:void(0);"><span>异动金额小于等于'+s+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(r),e()}else if(""==s){var r='<li class="chosed-trans-money select active"><a href="javascript:void(0);"><span>异动金额大于等于'+n+'</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(r),e()}else if(parseInt(n)>=parseInt(s));else{var r='<li class="chosed-trans-money select active"><a href="javascript:void(0);"><span>异动金额在'+n+"到"+s+'之间</span><i class="glyphicon glyphicon-remove"></i></a></li>';$(".filterResult").find("ul").append(r),e()}})}),$(".record-cont-list").find(".search-btn").on("click",function(){$(".record-cont").addClass("hide"),d(),e(),a(),l(),r()}),$(".input-group-addon").on("click",function(){$(".record-cont").addClass("hide"),d(),e(),a(),l(),r()}),$(".record-cont-list").find(".clear-btn").on("click",function(){$(".record-cont-list").find("a").removeClass("active"),$(".record-cont-list").find(".noadd").addClass("active"),$(".other-record").find("input").val(""),$(".pro-input").val(""),$(".client-input").val(""),$(".store-input").val(""),$(".filterResult").find("li").remove()})});
$(function(){function t(t){$("."+t).next().next().hasClass("active")||($(".detailBody").find("tbody").html(""),o(),_.pagesize=$(".rows-page").val(),_.page=parseInt($(".pagination").find(".active").find("a").text())-1,r())}function s(t){$("."+t).prev().prev().hasClass("active")||($(".detailBody").find("tbody").html(""),o(),_.pagesize=$(".rows-page").val(),_.page=parseInt($(".pagination").find(".active").find("a").text())+1,r())}function a(t){o(),_.pagesize=$(".rows-page").val(),_.page=$(".pagination").find("."+t).find("a").text(),r()}function i(){$(".father-drop").find("select").change(function(){if("全部大分类"==$(this).val())$(".child-drop")&&$(".child-drop").addClass("hide");else{for(var t=0;t<y.length;t++)if($(this).val()==y[t].CLASSNAME&&y[t].SUBDATA){var s='<div class="child-drop form-group pull-left hide"><select class="form-control">';for(k=0;k<y[t].SUBDATA.length;k++)s+="<option>"+y[t].SUBDATA[k].CLASSNAME+"</option>";s+="</select></div>"}$(".child-drop")&&($(".child-drop").remove(),$(".dropdown-box").append(s)),$(".child-drop").removeClass("hide")}})}function e(){$(".filter-result-down").find("a").on("click",function(){var t=$(this);t.parent("li").hasClass("chose-status")?($(".chose-status").remove(),$(".goods-status").find("li").removeClass("active"),$(".goods-status").find(".noadd").addClass("active")):t.parent("li").hasClass("chose-type")?($(".chose-type").remove(),$(".goods-type").find("li").removeClass("active"),$(".goods-type").find(".noadd").addClass("active")):t.parent("li").hasClass("chose-store")?($(".chose-store").remove(),$(".goods-store").find("input").val(""),$(".goods-store").find("li").removeClass("active"),$(".goods-store").find(".noadd").addClass("active")):t.parent("li").hasClass("chose-price")?($(".chose-price").remove(),$(".goods-price").find("input").val(""),$(".goods-price").find("li").removeClass("active"),$(".goods-price").find(".noadd").addClass("active")):t.parent("li").hasClass("chose-pic")&&($(".chose-pic").remove(),$(".goods-pic").find("li").removeClass("active"),$(".goods-pic").find(".noadd").addClass("active"))})}function l(){$(".filter-result-tit").find("a").on("click",function(){0!==$(this).parent("li").siblings("li").length||$(".filterOutterResult").hide(),$(this).parent("li").hasClass("chose-status")?($(".chose-status").remove(),$(".goods-status").find("li").removeClass("active"),$(".goods-status").find(".noadd").addClass("active")):$(this).parent("li").hasClass("chose-type")?($(".chose-type").remove(),$(".goods-type").find("li").removeClass("active"),$(".goods-type").find(".noadd").addClass("active")):$(this).parent("li").hasClass("chose-store")?($(".chose-store").remove(),$(".goods-store").find("input").val(""),$(".goods-store").find("li").removeClass("active"),$(".goods-store").find(".noadd").addClass("active")):$(this).parent("li").hasClass("chose-price")?($(".chose-price").remove(),$(".goods-price").find("input").val(""),$(".goods-price").find("li").removeClass("active"),$(".goods-price").find(".noadd").addClass("active")):$(this).parent("li").hasClass("chose-pic")&&($(".chose-pic").remove(),$(".goods-pic").find("li").removeClass("active"),$(".goods-pic").find(".noadd").addClass("active")),o(),r(),n()})}function o(){var t=$(".goods-status").find(".active").attr("value"),s=$(".goods-type").find(".active").attr("value"),a=$(".min-store").val(),i=$(".max-store").val(),e=$(".min-price").val(),l=$(".max-price").val(),o=$(".search-input").val(),d=$(".father-drop").find("select").val(),c=$(".child-drop").find("select").val(),n=[];t&&n.push("shelfflag:'"+t+"'"),s&&n.push("protype:'"+s+"'"),o&&n.push("default:'"+o+"'"),""==$(".dropdown-box").html()||("全部大分类"==d?$(".child-drop").addClass("hide"):($(".child-drop").removeClass("hide"),"全部小分类"==c?n.push("proclass:'"+d+"'"):n.push("proclass:'"+d+"','"+c+"'"))),_.indexs=n;var r=[];a&&r.push("qty>="+a),i&&r.push("qty<="+i),e&&r.push("price>="+e),l&&r.push("price<="+l),_.filter=r}function d(t){var s=Number($(".rows-page").val());c(1,s,t),$("#callBackPager").extendPagination({totalCount:t,limit:s,callback:function(t,s,a){c(t,s,a)}})}function c(t,s,a){var i=s;a-t*s<0&&(i=a-(t-1)*s)}function n(){$.ajax({url:"/p/c/slorload",type:"get",data:{PARAM:JSON.stringify(_)},success:function(t){d(t.result.total)},error:function(t){}})}function r(){$.ajax({url:"/p/c/slorload",type:"get",data:{PARAM:JSON.stringify(_)},success:function(t){for(var s=t.result.items,a=0;a<s.length;a++){var i='<tr id="'+s[a].id+'"><td class="check hidden-xs"><input type="checkbox"/></td><td class="goods-name"><div class="preview cur-p"><img src="beiCSSJS/ver2Style/img/pic.jpg"/></div><div class="maxname">'+s[a].proname+"</div><div><a >配饰</a><a >毛衣链</a></div></td><td>"+s[a].prono+'</td><td>+</td><td class="sp-price">'+s[a].price+'</td><td class="store-num">'+s[a].qty+'</td><td><a class="in-store" href="javascript:void(0)">入库</a>|<a class="out-store" href="javascript:void(0)">出库</a>|<a class="inout-record" href="javascript:void(0)">出入记录</a>|<a class="delete-line" href="javascript:void(0)">删除</a></td></tr>';$(".detailBody").find("tbody").append(i)}$(".detailBody").append("</tbody></table>"),$(".Table_table_oynRK").each(function(){$("#checkAll").click(function(){$("#checkAll").is(":checked")?($(".Table_table_oynRK input[type=checkbox]").each(function(){$(this).prop("checked",!0)}),$(".edit-all").removeClass("disabled").removeClass("btn-grey")):($(".Table_table_oynRK input[type=checkbox]").each(function(){$(this).prop("checked",!1)}),$(".edit-all").addClass("disabled").addClass("btn-grey"))})}),p(),m(),g()},error:function(t){}})}function p(){$(".sorting").on("click",function(){var t={};t.order="";var s=[];"价格"==$(this).text()?t.field="price":"库存"==$(this).text()&&(t.field="qty"),$(this).hasClass("asc")?($(this).removeClass("asc"),$(this).attr("title","默认排序"),t.order="",s.push(JSON.stringify(t))):$(this).hasClass("desc")?($(this).addClass("asc"),$(this).removeClass("desc"),$(this).attr("title","升序"),t.order="+",s.push(JSON.stringify(t))):($(this).addClass("desc"),$(this).attr("title","降序"),t.order="-",s.push(JSON.stringify(t))),_.sort=s,$.ajax({url:"/p/c/slorload",type:"get",data:{PARAM:JSON.stringify(_)},success:function(t){var s=t.result.items;$("#table1").find("tbody").html("");for(var a=0;a<s.length;a++){'<tr id="'+s[a].id+'"><td class="check hidden-xs"><input type="checkbox"/></td><td class="goods-name"><div class="preview cur-p"><img src="beiCSSJS/ver2Style/img/pic.jpg"/></div><div class="maxname">'+s[a].proname+"</div><div><a >配饰</a><a >毛衣链</a></div></td><td>"+s[a].prono+'</td><td>+</td><td class="sp-price">'+s[a].price+'</td><td class="store-num">'+s[a].qty+'</td><td><a class="in-store" href="javascript:void(0)">入库</a>|<a class="out-store" href="javascript:void(0)">出库</a>|<a class="inout-record" href="javascript:void(0)">出入记录</a>|<a class="delete-line" href="javascript:void(0)">删除</a></td></tr>';$(".detailBody").find("tbody").append(tableCont)}$(".detailBody").append("</tbody></table>")},error:function(t){}})})}function u(t){var s="",a=C.split("</li>");a.pop();for(var i=0;i<a.length;i++)a[i]=a[i]+"</li>",$(a[i]).text().indexOf(t)>=0&&(s+="<li>"+$(a[i]).text()+"</li>");$(".dialog-pro-cont").html(s),$(".dialog-pro-cont").find("li").on("click",function(){$(".dialog-pro-cont").hide(),$(".gys-input").val($(this).text()),x=$(this).attr("id")})}function v(){var t={TABLENAME:"c_sup",COLUMNS:"id,supname"};$.ajax({url:"/p/cs/QueryTable",type:"get",data:{PARAM:JSON.stringify(t)},success:function(t){$(".dialog-pro-cont").html("");for(var s=JSON.parse(t.result),a=0;a<s.length;a++){var i='<li id="'+s[a].id+'">'+s[a].supname+"</li>";$(".dialog-pro-cont").append(i)}C=$(".dialog-pro-cont").html()},error:function(t){}})}function h(){$(".gys-input").on("click",function(t){$(".dialog-pro-cont").show(),t.stopPropagation(),u($(this).val())}),$(".gys-input").keyup(function(){u($(this).val())})}function f(){$(".aui_close").on("click",function(){$(this).parents(".aui_outer").hide()}),$(".in_aui_no").on("click",function(){$(this).parents(".aui_outer").hide()})}function m(){$(".out-store").on("click",function(){$("#myDialog").html("");var t=$(this),s=$(this).parent("td").siblings(".goods-name").find(".maxname").text(),a=$(this).parent("td").siblings(".store-num").text();if(0==$(this).parent("td").siblings(".store-num").text()){var i='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_w"></td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title" style="cursor: move;">商品出库</div><a class="aui_close" href="javascript:void(0);">×</a></div></td></tr><tr><td class="aui_icon"><div class="aui_iconBg" style="background: url(../img/warning.png);"></div></td><td class="aui_main" style="width: auto; height: auto;"><div class="aui_content" style="padding: 20px 25px;">该商品已经没有库存，无法出库！<br>请先通过盘点功能，修正数量后，再尝试出库。<br><br><a href="http://www.i200.cn/bbs/thread-5189-1-1.html?from=appweb" target="_blank">点击这里查看</a>，导致负库存的常见原因。</div></td></tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><button class="aui_state_highlight" type="button">盘点调整</button><button type="button" class="in_aui_no">取消</button></div></td></tr></tbody></table></div></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se" style="cursor: se-resize;"></td></tr></tbody></table></div>';$("#myDialog").append(i)}else{var i='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title">商品出库</div><a class="aui_close" href="javascript:void(0);">×</a></div></td></tr><tr><td class="aui_icon" style="display:none;"><div class="aui_iconBg"></div></td><td class="aui_main"><div class="aui_content"><div id="boxStockOut"><div class="form-horizontal padding-15" style="width: 400px;"><div class="form-group m-b-10"><label for="stockOutName" class="col-sm-4 col-md-4 text-normal text-right control-label">商品名称</label><div class="col-sm-8 col-md-8" style="padding-top: 7px;"><span id="stockOutName">'+s+'</span><input id="stockOutGid" type="hidden" value="14005416"/><input id="stockOutSkuid" type="hidden" value="0"/></div></div><div class="form-group m-b-10"><label for="stockOutNowNum" class="col-sm-4 col-md-4 text-normal text-right control-label">现有库存：</label><div class="col-sm-8 col-md-8" style="padding-top: 7px;"><span id="stockOutNowNum" class="fs-16 text-main bold">'+a+'</span></div></div><div class="form-group m-b-10"><label class="col-sm-4 col-md-4 text-normal text-right control-label">供应商：</label><div class="col-sm-8 procont"><input type="text" class="form-control gys-input" placeholder="请输入供应商"><ul class="dialog-pro-cont" style="display: none;"></ul></div></div><div class="form-group m-b-10"><label for="stockOutNum" class="col-sm-4 col-md-4 text-normal text-right control-label">出库数量：</label><div class="col-sm-8 col-md-8"><input type="text" class="form-control" id="stockOutNum" data-validate="Quantity" maxlength="11"><p class="help-block"></p></div></div><div class="form-group m-b-10"><label class="col-sm-4 col-md-4 text-normal text-right control-label">出库类型：</label><div class="col-sm-8 col-md-8"><select id="stockOutClass" class="form-control"><option>采购退货出库</option><option>销售出售</option></select><p class="help-block"></p></div></div><div id="allocateDiv" class="form-group m-b-10 hidden"><label class="col-sm-4 col-md-4 text-normal text-right control-label">调入店铺：</label><div class="col-sm-8 col-md-8"><select id="allocationShop" class="form-control"></select><p class="help-block"></p></div></div><div class="form-group m-b-10"><label for="stockOutRemark" class="col-sm-4 col-md-4 text-normal text-right control-label">备注说明：</label><div class="col-sm-8 col-md-8"><textarea id="stockOutRemark" cols="2" rows="2" class="form-control" disabled="disabled">采购退货出库</textarea></div></div></div></div></div></td></tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><button class="aui_state_highlight out_aui_ok" type="button">确定</button><button type="button" class="in_aui_no">取消</button></div></td></tr></tbody></table></div></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se" style="cursor: se-resize;"></td></tr></tbody></table>';$("#myDialog").append(i),$("#stockOutNum").keyup(function(){if(/[^\d]/.test($(this).val())){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}}),v(),h(),$(".out_aui_ok").on("click",function(){var s={};s.BILLTYPE=2,s.BILLSOURCE=11,s.STORENAME=$("#stockOutName").text(),s.PARTNERTYPE=1,s.PARTNER=$(".gys-input").val(),s.C_PRO_ID=t.parents("tr").attr("id"),s.SKUNO=[],s.PRICE=t.parent("td").siblings(".sp-price").text(),s.QTY=[$("#stockOutNum").val()],s.PARTNERNO=x,$.ajax({url:"/p/cs/stchangeItemCreate",type:"GET",data:{B_STCHANGEITEM:JSON.stringify(s)},success:function(t){},error:function(t){}})})}f()}),$(".in-store").on("click",function(){$("#myDialog").html("");var t=$(this),s='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_w"></td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title" style="cursor: move;">商品入库</div><a class="aui_close" href="javascript:void(0);">×</a></div></td></tr><tr><td class="aui_icon" style="display: none;"><div class="aui_iconBg" style="background: none;"></div></td><td class="aui_main" style="width: 420px; height: auto; visibility: visible;"><div class="aui_content" style="padding: 10px 0px;"><div id="boxStockInto" style="display: block;"><div class="form-horizontal padding-15" style="width: 400px;"><div class="form-group m-b-10"><label for="stockName" class="col-sm-4 col-md-4 text-normal text-right control-label">商品名称：</label><div class="col-sm-8 col-md-8" style="padding-top: 7px;"><span id="stockName" style="" class="fs-16 text-main bold">333333</span><input id="stockGid" type="hidden" value="14835465"><input id="stockSkuid" type="hidden" value="0"></div></div><div class="form-group attributeSelect" style="display: none;"><label class="col-sm-4 col-md-4 text-normal text-right control-label">选择属性：</label><div class="col-sm-8 col-md-8 attributeItems"><select class="attrEditItems form-control" onchange="StockIntoSelectAttriutes(this)"></select></div></div><div class="form-group m-b-10"><label for="stockNowNum" class="col-sm-4 col-md-4 text-normal text-right control-label">当前库存：</label><div class="col-sm-8 col-md-8" style="padding-top: 7px;"><span id="stockNowNum" class="fs-16 text-main bold">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #737373;" id="showPrice">（ 库存进价：<span id="goodsNowPrice">0</span>)</span></div></div><div class="form-group m-b-10"><label class="col-sm-4 col-md-4 text-normal text-right control-label">供应商：</label><div class="col-sm-8 procont"><input type="text" class="form-control gys-input" placeholder="请输入供应商"><ul class="dialog-pro-cont" style="display: none;"></ul></div></div><div class="form-group m-b-10"><label for="stockIntoNum" class="col-sm-4 col-md-4 text-normal text-right control-label">入库数量：</label><div class="col-sm-8 col-md-8"><input type="text" class="form-control" id="stockIntoNum" maxlength="11" data-validate="Quantity"><!-- <p class="help-block"></p> --></div></div><div class="form-group m-b-10" id="thisPriceSpan" style=""><label for="stockIntoNum" class="col-sm-4 col-md-4 text-normal text-right control-label">本批次进价：</label><div class="col-sm-8 col-md-8"><input type="text" class="form-control" placeholder="进价不变时，无需填写" id="thisPrice" maxlength="9"><p class="help-block"></p></div></div><div class="form-group m-b-10" style="display: none;" id="endPrice"><label for="stockIntoNum" class="col-sm-4 col-md-4 text-normal text-right control-label">平均进价：</label><div class="col-sm-8 col-md-8"><input type="text" class="form-control" id="averagePrice" style="color: red;" maxlength="9"><p style="margin-top: 10px; color: #737373;">（进价不同，加权平均计算取均价）<span class="saleAddNameTipe" id="endPriceCalcTips" keyval="0" data-hasqtip="1"></span></p></div></div><div class="form-group m-b-10" style="display: none;"><label for="gCostPrice" class="col-sm-4 col-md-4 text-normal text-right control-label">商品进价：</label><div class="col-sm-8 col-md-8"><input type="text" class="form-control" id="gCostPrice" maxlength="6"><span class="helperInfoTips" aria-describedby="ui-tooltip-22"></span><p class="help-block"></p></div></div><div class="form-group stockInfoOtherData"><label for="stockIntoDate" class="col-sm-4 col-md-4 text-normal text-right control-label">入库时间：</label><div class="col-sm-8 col-md-8"><input type="text" class="form-control" id="stockIntoDate" onfocus="WdatePicker()" value="2016-12-14"><p class="help-block"></p></div></div><div class="form-group stockInfoOtherData"><label for="stockRemark" class="col-sm-4 col-md-4 text-normal text-right control-label">备注说明：</label><div class="col-sm-8 col-md-8"><textarea id="stockRemark" cols="2" rows="2" class="form-control"></textarea></div></div></div></div></div></td></tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><button class="aui_state_highlight in_aui_ok" type="button">确定</button><button class="in_aui_no" type="button">取消</button></div></td></tr></tbody></table></div></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se" style="cursor: se-resize;"></td></tr></tbody></table></div>';$("#myDialog").append(s),f(),$("#stockIntoNum").keyup(function(){if(/[^\d]/.test($(this).val())){var t=$(this).val().replace(/[^\d]/g,"");$(this).val(t)}}),v(),h(),$(".in_aui_ok").on("click",function(){var s={};s.BILLTYPE=1,s.BILLSOURCE=11,s.STORENAME=$("#stockName").text(),s.PARTNERTYPE=1,s.PARTNER=$(".gys-input").val(),s.C_PRO_ID=t.parents("tr").attr("id"),s.SKUNO=[],s.PRICE=t.parent("td").siblings(".sp-price").text(),s.QTY=[$("#stockIntoNum").val()],s.PARTNERNO=x,s.BILLDATE=$("#stockIntoDate").attr("value"),$.ajax({url:"/p/cs/stchangeItemCreate",type:"GET",data:{B_STCHANGEITEM:JSON.stringify(s)},success:function(t){},error:function(t){}})})})}function g(){$(".delete-line").on("click",function(){if(0==$(this).parent("td").siblings(".store-num").text()){var t='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_w"></td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title" style="cursor: move;">消息</div><a class="aui_close" href="javascript:void(0);">×</a></div></td></tr><tr><td class="aui_icon"><div class="aui_iconBg" style="background: url(../img/question.png);"></div></td><td class="aui_main" style="width: auto; height: auto; visibility: visible;"><div class="aui_content" style="padding: 20px 25px;">商品信息删除后将无法恢复，你确定要彻底删除吗？</div></td></tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><button class="aui_state_highlight" type="button">确定</button><button type="button" class="in_aui_no">取消</button></div></td></tr></tbody></table></div></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se" style="cursor: se-resize;"></td></tr></tbody></table></div>';$("#myDialog").append(t),f()}else{var t='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_w"></td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title" style="cursor: move;">删除商品</div><a class="aui_close" href="javascript:void(0);">×</a></div></td></tr><tr><td class="aui_icon"><div class="aui_iconBg" style="background: url(../img/warning.png);"></div></td><td class="aui_main" style="width: auto; height: auto; visibility: visible;"><div class="aui_content" style="padding: 20px 25px;">仅能删除库存为0的商品。当前商品库存为43，您可以先销售或出库。</div></td></tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><button type="button">销售</button><button class="aui_state_highlight" type="button">出库</button></div></td></tr></tbody></table></div></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se" style="cursor: se-resize;"></td></tr></tbody></table></div>';$("#myDialog").append(t),f()}})}function b(){var t=$(".filter-result-down").html();0==$(".filter-result-down").find("li").length||($(".filterOutterResult").show(),$(".filterOutterResult").html(""),$(".filterOutterResult").append('<div class="filter-title">已选择</div><div class="filter-elem"><ul class="list-unstyled filter-result-tit">'+t+"</ul></div>"),$(".filter-content").addClass("hide")),l()}var y;$(document).ready(function(){$.ajax({url:"/p/cs/load",type:"GET",success:function(t){y=t.data;for(var s='<div class="father-drop form-group pull-left"><select class="form-control"><option>全部大分类</option>',a=0;a<y.length;a++)s+="<option>"+y[a].CLASSNAME+"</option>";s+="</select></div>",$(".dropdown-box").append(s),i()},error:function(t){}}),_={indexs:[],filter:[],pagesize:"10",page:"1"},r(),n()}),$(".rows-page").change(function(){$(".detailBody").find("tbody").html(""),o(),_.pagesize=$(this).val(),_.page=$(".pagination").find(".active").find("a").text(),n(),r()}),$(document).on("click","#callBackPager .pagination li",function(){$(".detailBody").find("tbody").html(""),$(this).hasClass("previous")?t("previous"):$(this).hasClass("next")?s("next"):$(this).hasClass("active")&&a("active")}),$(".filter-goods").on("click",function(){$(".filterOutterResult").hide(),$(".filter-content").toggleClass("hide")}),$(".other-select").find("input").focus(function(){$(this).parents(".fgoods-cont").find("li").removeClass("active"),$(this).keyup(function(){var t=$(".min-store").val(),s=$(".max-store").val(),a=$(".min-price").val(),i=$(".max-price").val();if($(this).parents("ul").hasClass("goods-store")){if($(".filter-result-down").find(".chose-store").remove(),/[^\d]/.test($(this).val())){var l=$(this).val().replace(/[^\d]/g,"");$(this).val(l)}if(""==t)if(""==s);else{var o='<li class="chose-store select active"><a href="javascript:void(0);"><span>库存小于等于'+s+"</span><i>×<i></a></li>";$(".filter-result-down").append(o),e()}else if(""==s){var o='<li class="chose-store select active"><a href="javascript:void(0);"><span>库存大于等于'+t+"</span><i>×<i></a></li>";$(".filter-result-down").append(o),e()}else if(parseInt(t)>=parseInt(s));else{var o='<li class="chose-store select active"><a href="javascript:void(0);"><span>库存在'+t+"到"+s+"之间</span><i>×<i></a></li>";$(".filter-result-down").append(o),e()}}else if($(this).parents("ul").hasClass("goods-price")){if(/[^\d]/.test($(this).val())){var l=$(this).val().replace(/[^\d]/g,"");$(this).val(l)}if($(".filter-result-down").find(".chose-price").remove(),""==a)if(""==i);else{var d='<li class="chose-price select active"><a href="javascript:void(0);"><span>价格小于等于'+i+"</span><i>×<i></a></li>";$(".filter-result-down").append(d),e()}else if(""==i){var d='<li class="chose-price select active"><a href="javascript:void(0);"><span>价格大于等于'+a+"</span><i>×<i></a></li>";$(".filter-result-down").append(d),e()}else if(parseInt(a)>=parseInt(i));else{var d='<li class="chose-price select active"><a href="javascript:void(0);"><span>价格在'+a+"到"+i+"之间</span><i>×<i></a></li>";$(".filter-result-down").append(d),e()}}})}),$(".fgoods-cont").find("a").on("click",function(){function t(t){if($(".filter-result-down").find("li").hasClass(t))$("."+t).find("span").text(s);else{var a='<li class="'+t+' select active"><a href="javascript:void(0);"><span>'+s+"</span><i>×<i></a></li>";$(".filter-result-down").append(a)}e()}$(this).parents(".fgoods-cont").find("li").removeClass("active"),$(this).parent("li").addClass("active");var s=$(this).text();$(this).parent("li").hasClass("noadd")?$(this).parents("ul").hasClass("goods-status")?$(".chose-status").remove():$(this).parents("ul").hasClass("goods-type")?$(".chose-type").remove():$(this).parents("ul").hasClass("goods-store")?$(".chose-store").remove():$(this).parents("ul").hasClass("goods-price")?$(".chose-price").remove():$(".chose-pic").remove():$(this).parents().hasClass("goods-status")?t("chose-status"):$(this).parents().hasClass("goods-type")?t("chose-type"):$(this).parents().hasClass("goods-store")?t("chose-store"):$(this).parents().hasClass("goods-price")?t("chose-price"):$(this).parents().hasClass("goods-pic")&&t("chose-pic")});var _={};$(".search-input").keydown(function(t){13==t.keyCode&&($(".input-filter-cont").addClass("hide"),$(".detailBody").find("tbody").html(""),o(),r(),n())}),$(".input-group-addon").on("click",function(){$(".detailBody").find("tbody").html(""),$(".filter-content").addClass("hide"),b(),o(),r(),n()}),$(".search-btn").on("click",function(){$(".detailBody").find("tbody").html(""),$(".filter-content").addClass("hide"),b(),o(),r(),n()});var x="",C="";$("html").click(function(){$(".dialog-pro-cont").is(":hidden")||$(".dialog-pro-cont").hide()}),$(".clear-btn").on("click",function(){$(".fgoods-cont").find("a").removeClass("active"),$(".fgoods-cont").find(".noadd").addClass("active"),$(".other-select").find("input").val(""),$(".filter-result-down").html("")}),$(".aui_state_focus").on({mousedown:function(t){var s=$(this),a=($(this).css("z-index"),s.offset());dx=t.pageX-a.left,dy=t.pageY-a.top,$(document).on("mousemove.drag",function(t){s.offset({top:t.pageY-dy,left:t.pageX-dx})})},mouseup:function(t){$(document).off("mousemove.drag")}})});
function SetSerialNumber(t){null!=t&&Settings.OnOrOffClick(t)}function setIntegralCommuteProportion(t){null!=t&&Settings.OnOrOffClick(t)}function setWipeTheZeroConfig(t){null!=t&&Settings.OnOrOffClick(t)}function AddDiscount(){$.dialog.prompt("请输入折扣(1-10数字)：",function(t){var e=10,n=/^[0-9\.]{1,20}$/;if(!n.test(t))return window.parent.fn_tips("折扣必须为纯数字！"),!1;if(e=parseFloat(t),e<=0||e>10)return window.parent.fn_tips("请输入0-10数字（不包含0）！"),!1;var i="/Function/SystemSettings.ashx?type=adddiscount";$.doAjax(i,{discount:e},function(t){if("error"!=t){var e=Number(t);if(e>0)return window.parent.fn_tips("新折扣保存成功！"),GetDiscountList(),!0;if(e==-1||0==e)return window.parent.fn_tips("已经存在此折扣！"),!1;if(e==-2)return window.parent.fn_tips("预设折扣数已达上限！"),!1}window.parent.fn_tips("增加新的折扣失败！")},!1)},"")}$(function(){$(".form-tit").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})});var Settings={Init:function(){Settings.doAjax(0),$(".setting-nav>ul>li").click(function(){$(".setting-nav>ul>li").removeClass("active");var t=$(this);t.addClass("active");var e=$(t).parent().index(),n=0;0==e?n=0:1==e?n=$(t).parent().parent().find("ul.first>li").length:2==e&&(n=$(t).parent().parent().find("ul.first>li").length+$(t).parent().parent().find("ul.second>li").length);var i=$(t).index()+n;Settings.doAjax(i)}),$(".setting-nav>ul"),$(".edit-tit>a").click(function(){$(".edit-info").find(td.editable)})},doAjax:function(t){var e="/setting/mystore.html";switch(t){case 0:e="/set/myStore.html";break;case 1:e="/set/dataInfo.html";break;case 2:e="/set/sales.html";break;case 3:e="/set/goods.html";break;case 4:e="/set/member.html";break;case 5:e="/set/clerk.html";break;case 6:e="/set/message.html";break;case 7:e="/set/withdrawal.html";break;case 8:e="/set/wxbind.html";break;case 9:e="/set/mobileWindow.html";break;case 10:e="/set/print.html";break;case 11:e="/set/wxbind.html";break;case 12:e="/set/mobileWindow.html";break;default:e="/set/mystore.html"}$.ajax({type:"GET",url:e,success:function(t){$(".setting-container").html(t)},error:function(t){}})},editInfo:function(){for(var t=$(".edit-info").find("td.editable"),e=0,n=[];t.length--;)n[e]=t[e].innerText,t[e].innerHTML="<input type='text' value="+n[e]+">",e++},OnOrOffClick:function(t){$(t).hasClass("onoroff_off")?($(t).removeClass("onoroff_off").addClass("onoroff_on").attr("initial","on"),$(t).find("div").removeClass("slide_off").addClass("slide_on")):($(t).removeClass("onoroff_on").addClass("onoroff_off").attr("initial","off"),$(t).find("div").removeClass("slide_on").addClass("slide_off"))}};
var setting={data:function(){return{childId:"",showchild:function(){var e=event.currentTarget,n=$(e).attr("url"),t=($(e).text(),$(e).attr("name")),a="",c=this;$.ajax({url:n,dataType:"html",async:!1,success:function(e){a=e}});var r=t+"_conf";if(confjs="/js/m/"+t+"_conf.js",$.ajax({url:confjs,type:"GET",dataType:"script",async:!1,success:function(e,n){},error:function(e,n){}}),window[r])for(var o=0;o<window[r].before.length;o++)$.ajax({url:window[r].before[o],type:"GET",dataType:"script",async:!1,success:function(e,n){},error:function(){}});if(window[t]){window[t].template=a;var i=Vue.extend(window[t]);Vue.component(t,i),c.childId=t}else{var i=Vue.extend({template:a});Vue.component(t,i),c.childId=t}}}}};